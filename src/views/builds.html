{% extends "base.html" %}

{% block content %}
<form method="POST" action="{{ url_for('show_builds') }}">
  <div class="d-flex align-items-start">
    <div class="form-group ms-3 d-flex flex-column">
      <div id="champ-container" class="champ-container">
        <label for="champion" class="form-label">Campeão:</label>
        <select name="champion" id="champion" class="form-select form-select-sm" required>
          {% for champion_id, champion_data in champions.items() %}
          <option value="{{ champion_id }}" data-image="{{ champion_data.image_url }}">{{ champion_data.name }}</option>
          {% endfor %}

        </select>
      </div>
    </div>

    <div class="form-group ms-3">
      <label for="mainrune" class="form-label">Runa Principal:</label>
      <select name="mainrune" id="mainrune" class="form-select form-select-sm" required>
        {% for main_rune in runas %}
        <option value="{{ main_rune.name }}">{{ main_rune.name }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="form-group ms-3 w-50">
      <label for="items" class="form-label">Itemização:</label>
      <div id="items-container" class="items-container">
        <select id="items-select" name="items-select" class="form-select form-select-sm" multiple required>
          {% for item in items %}
          <option value="{{ item.name }}">{{ item.name }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
    <div class="d-flex justify-content-center mt-3 ms-3">
      <button type="submit" class="btn btn-success">Adicionar Build</button>
    </div>
  </div>
</form>

<h1>Lista de Builds</h1>

<!-- Tabela para exibir as builds -->
<table class="table table-striped">
  <thead>
    <tr>
      <th>Campeão</th>
      <th>Runa Principal</th>
      <th>Itens</th>
    </tr>
  </thead>
  <tbody>
    {% for build in builds %}
    <tr>
      <td>
        {% if build.champion in champions %}
        <img src="{{ champions[build.champion]['image_url'] }}" alt="{{ build.champion }}"
          style="width: 30px; height: 30px; object-fit: cover" />
        {% else %}
        <span>Imagem não encontrada</span>
        {% endif %}
        <strong>{{ build.champion }}</strong>
      </td>
      <td>
        {% if build.runes %}
        {{ build.runes }}
        {% else %}
        <em>Não definida</em>
        {% endif %}
      </td>
      <td>
        {% if build.items_selected %}
        {% if build.items_selected is iterable %}
        <ul>
          {% for item in build.items_selected %}
          <li>{{ item }}</li>
          {% endfor %}
        </ul>
        {% else %}
        <p>{{ build.items_selected }}</p>
        {% endif %}
        {% else %}
        <p>Sem itens definidos.</p>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
  $(document).ready(function () {
    $("#champion").select2({
      placeholder: "Selecione um campeão",
      templateResult: function (state) {
        if (!state.id) {
          return state.text;
        }

        var $state = $(
          '<span><img src="' + $(state.element).data('image') + '" style="width: 30px; height: 30px; object-fit: cover; margin-right: 10px;" /> ' + state.text + '</span>'
        );
        return $state;
      },
      templateSelection: function (state) {
        return state.text;
      }
    });

    $("#items-select").select2({
      placeholder: "Selecione até 5 itens",
      maximumSelectionLength: 5,
      allowClear: true,
    });
  });
</script>

{% endblock %}